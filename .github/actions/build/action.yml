name: "Build"
description: "Build the project and run local tests"

runs:
  using: 'composite'
  steps:
    - name: Validate Gradle Wrapper
      uses: gradle/actions/wrapper-validation@v3

    - name: Copy CI gradle.properties
      run: mkdir -p ~/.gradle ; cp .github/ci-gradle.properties ~/.gradle/gradle.properties
      shell: bash

    - name: Setup JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'zulu' # See 'Supported distributions' for available options
        java-version: '17'

    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v3

    # Run tests assemble
    - name: Run local tests
      run: ./gradlew testDebugUnitTest --stacktrace
      shell: bash

    # Create APK and AAB
    - name: Build all assemble type and flavor permutations
      run: |
        ./gradlew :app:assemble
        ./gradlew :app:bundle
      shell: bash